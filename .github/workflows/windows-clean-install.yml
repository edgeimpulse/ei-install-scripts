name: Windows Clean Install
on: [push]
jobs:
  Windows-Clean-Install:
    runs-on: windows-latest
    steps:
      - name: ğŸ‘‰ğŸ½ Configure
        run: $VerbosePreference = "Continue"
      - name: ğŸ‘‰ğŸ½ Update Execution Policy
        run: |
          $Policy = Get-ExecutionPolicy -Scope Process;
          echo "Policy was $Policy"
          Set-ExecutionPolicy Bypass -Scope Process -Force;
          $Policy = Get-ExecutionPolicy -Scope Process;
          echo "Policy is now $Policy"
      - name: ğŸ‘‰ğŸ½ Update SecurityProtocol
        run: |
          $Protocol = [System.Net.ServicePointManager]::SecurityProtocol
          echo "Protocol was $Protocol"
          [System.Net.ServicePointManager]::SecurityProtocol = [System.Net.ServicePointManager]::SecurityProtocol -bor 3072;
          $Protocol = [System.Net.ServicePointManager]::SecurityProtocol
          echo "Protocol is now $Protocol"
      - name: ğŸ‘‰ğŸ½ Download script
        run: |
          iwr -Uri "https://raw.githubusercontent.com/edgeimpulse/ei-install-scripts/${{ github.ref_name }}/install-windows.ps1" -Outfile install.ps1;
          dir;
      - name: ğŸ‘‰ğŸ½ Execute script
        run: |
          dir;
          Get-Content -Path .\install.ps1 -TotalCount 5
          Invoke-Expression -Command "$pwd\install.ps1";
          dir;
      - name: ğŸ‘‰ğŸ½ Delete script
        run: |
          del .\install.ps1;
          dir;
      - name: ğŸ‘‰ğŸ½ Test as a one-liner
        run: |
          Set-ExecutionPolicy Bypass -Scope Process -Force; [System.Net.ServicePointManager]::SecurityProtocol = [System.Net.ServicePointManager]::SecurityProtocol -bor 3072; iwr -Uri "https://raw.githubusercontent.com/edgeimpulse/ei-install-scripts/main/install-windows.ps1" -Outfile install.ps1; iex .\install.ps1; del .\install.ps1;
